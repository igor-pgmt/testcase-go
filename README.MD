## Реализация тестового задания 

Работа функционала предлагается по следующей схеме:

![Диаграмма](https://github.com/igor-pgmt/testcase-go/diagram.svg)

1) Frontend показывает пользователю список товаров из базы.
2) При запросе посмотреть информацию по конкретному товару, Frontend обращается к Endoint.
3) Endpoint, являясь сервером очередей, распределяет все поступающие запросы по агентам.
4) Agent проверяет, присутствует ли запрашиваемая информация в Redis. Если да - возвращает её через Endpoint клиенту.
5) Если в Redis информации нету, Agent обращается за информацией через API на сторонний ресурс (магазин Steam), возвращает полученную информацию через Endpoint клиенту и сохраняет её в Redis с указанием истечения времени хранения.

Так же, отдельные микросервисы периодически реализуют периодическое обновление информации в БД: курсы валют и список товаров (в [демо-примере](http://uptoy.ru/) - 1 раз в 300 секунд каждый; изменения стоимости товара в криптовалюте можно наблюдать на странице товара, периодически обновляя её, [например, тут](http://uptoy.ru/products/view?appid=828660)).

### Состав проекта
Проект состоит из пакетов:
 - Endpoint, который является "точкой входа", куда обращается Frontend. В Endpoint присутствует [веб-сервер go](https://golang.org/pkg/net/http/), а так же сервер очередей [go-nats](https://github.com/nats-io/go-nats).
 - Agent, который обрабатывает запросы от Endpoint. Этот пакет либо работает в режиме агента Endpoint (можно создать много агентов), либо в режиме микросервиса, который периодически обращается к steam и сохраняет список товаров в БД. В данной схеме присутствует один микросервис получения данных и несколько агентов.
 - Exrates, периодически получает данные о курсах валют с сайта [bitcoinaverage.com](https://bitcoinaverage.com/) и сохраняет их в бд.

### Технологии
В проекте использовались:
 - [Go-NATS](https://github.com/nats-io/go-nats)
 - [Redis v3.0.6](https://redis.io/)
 - [Yii2 v2.0.15.1](https://www.yiiframework.com/doc/guide/2.0/en/start-installation) (код демо-проекта находится [здесь](https://github.com/igor-pgmt/testcase-yii2))
 - [PHP v7.2.5-1](http://www.php.net/ChangeLog-7.php#7.2.5) из репозитория [Ondrej](https://launchpad.net/~ondrej/+archive/ubuntu/php), [PHP mongoDB driver](http://php.net/manual/ru/mongodb.installation.manual.php)
 - [mongodb v3.6.4](https://www.mongodb.com/download-center#community)


#### p.s. 
 - В демо-примере все товары выгружены едином списом без соблюдения зависимостей или какой-либо иерархии;
 - Некоторые товары в магазине Steam не имеют цены [например, этот](http://uptoy.ru/products/view?appid=863790), некоторые имеют цену [например, этот](http://uptoy.ru/products/view?appid=828660)
 - В рамках выполнения данного задания не учтены вопросы логгирования, защиты от ошибок, связанных с лимитом обращений на сторонних сервисах и т.п.
 